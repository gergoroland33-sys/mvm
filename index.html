<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>MVM Egyszer≈± Kalkul√°tor</title>
<style>
:root {
    --bg: #0f172a;
    --card: #1e293b;
    --primary: #3b82f6;
    --accent: #f59e0b;
    --text: #f8fafc;
    --border: #334155;
}

* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

body {
    font-family: 'Inter', sans-serif;
    background: var(--bg); color: var(--text);
    margin: 0; padding: 15px;
    padding-bottom: 100px; /* Hely a gombnak */
}

h1 { text-align: center; margin: 10px 0 30px; font-size: 1.5rem; color: var(--primary); }

/* NAGY K√ÅRTYA ST√çLUS */
.card {
    background: var(--card); border: 1px solid var(--border);
    border-radius: 20px; padding: 20px; margin-bottom: 20px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.5);
}

.label { font-size: 0.8rem; color: #94a3b8; text-transform: uppercase; margin-bottom: 5px; display: block; font-weight: bold; }

/* BEVITELI MEZ≈êK - JAV√çTVA */
.input-row { display: flex; gap: 15px; margin-bottom: 20px; }
.input-group { flex: 1; }

input[type="number"], input[type="tel"] {
    width: 100%; 
    background: #0b1120; 
    border: 2px solid var(--border);
    color: white; 
    padding: 15px; 
    font-size: 1.3rem; 
    font-weight: bold;
    border-radius: 12px;
    text-align: center;
    /* Ez hozza el≈ë a billenty≈±zetet: */
    -moz-appearance: textfield;
}
input::-webkit-outer-spin-button,
input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
input:focus { border-color: var(--primary); outline: none; background: #131c2e; }

/* EREDM√âNYEK */
.result-box {
    background: rgba(59, 130, 246, 0.1); border-radius: 15px;
    padding: 20px; text-align: center; margin-top: 10px;
    border: 1px solid rgba(59, 130, 246, 0.3);
}
.big-price { font-size: 2rem; font-weight: 900; color: white; margin: 5px 0; }
.sub-text { color: #94a3b8; font-size: 0.9rem; }

/* CS√öSZKA */
.slider-container { margin-top: 25px; background: rgba(0,0,0,0.2); padding: 15px; border-radius: 12px; }
input[type=range] { width: 100%; margin: 15px 0; }
.split-info { display: flex; justify-content: space-between; font-weight: bold; font-size: 1.1rem; }

/* T√ÅBL√ÅZAT */
table { width: 100%; border-collapse: collapse; margin-top: 10px; }
th { text-align: left; color: #64748b; font-size: 0.7rem; padding: 10px; border-bottom: 1px solid var(--border); }
td { padding: 12px 10px; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 0.9rem; }

/* MENT√âS GOMB */
.fab {
    position: fixed; bottom: 30px; right: 30px;
    background: var(--primary); color: white;
    width: 65px; height: 65px; border-radius: 50%;
    border: none; font-size: 2rem;
    box-shadow: 0 5px 20px rgba(59, 130, 246, 0.5);
    cursor: pointer; display: flex; align-items: center; justify-content: center;
}
.reset-btn {
    display: block; width: 100%; padding: 15px; margin-top: 30px;
    background: transparent; border: 1px solid var(--border); color: #ef4444;
    border-radius: 12px; text-align: center; cursor: pointer;
}
</style>
</head>
<body>

<h1>MVM Kalkul√°tor</h1>

<div class="card">
    <div class="input-row">
        <div class="input-group">
            <span class="label">El≈ëz≈ë (Fix)</span>
            <div id="prevDisp" style="padding: 15px; font-size: 1.3rem; font-weight: bold; color: #64748b; background: #0b1120; border-radius: 12px; text-align: center;">...</div>
        </div>

        <div class="input-group">
            <span class="label" style="color:var(--primary)">Jelenlegi</span>
            <input type="tel" id="currInput" placeholder="???" oninput="calc()" inputmode="decimal">
        </div>
    </div>

    <div class="result-box">
        <span class="label">Fizetend≈ë √ñsszeg</span>
        <div class="big-price" id="totalPrice">0 Ft</div>
        <div class="sub-text">Fogyaszt√°s: <span id="consVal">0</span> kWh</div>
    </div>

    <div class="slider-container">
        <div style="display:flex; justify-content:space-between; font-size:0.8rem; margin-bottom:5px;">
            <span>MEGOSZT√ÅS</span>
            <span style="color:var(--accent)">Anyu: <span id="momPct">50</span>%</span>
        </div>
        <input type="range" id="slider" min="0" max="100" value="50" oninput="calc()">
        <div class="split-info">
            <span style="color:var(--accent)" id="momMoney">0 Ft</span>
            <span style="color:white" id="myMoney">0 Ft</span>
        </div>
    </div>
</div>

<div class="card">
    <span class="label">El≈ëzm√©nyek (2025)</span>
    <table id="histTable">
        <thead>
            <tr><th>H√≥nap</th><th>√Åll√°s</th><th>Sz√°mla</th></tr>
        </thead>
        <tbody id="histBody"></tbody>
    </table>
</div>

<button class="fab" onclick="save()">üíæ</button>

<button class="reset-btn" onclick="hardReset()">‚ö†Ô∏è Adatok T√∂rl√©se & Vissza√°ll√≠t√°s</button>

<script>
// KONFIGUR√ÅCI√ì
const LIMIT = 210; 
const P_REZSI = 36.386;
const P_PIACI = 70.104;

// ALAP ADATOK (Itt m√°r kivettem a rossz Decembert!)
const startData = [
    { date: '2025-09-01', name: 'Augusztus', read: 17232, cons: 351, cost: 17527 },
    { date: '2025-10-01', name: 'Szeptember', read: 17583, cons: 231, cost: 9123 },
    { date: '2025-11-01', name: 'Okt√≥ber', read: 17814, cons: 557, cost: 32001 },
    { date: '2025-12-01', name: 'November', read: 18372, cons: 861, cost: 53284 }
];

let history = [];

// BET√ñLT√âS
function init() {
    let stored = localStorage.getItem('mvm_data_simple');
    if (stored) {
        history = JSON.parse(stored);
    } else {
        history = [...startData]; // M√°solat az alap adatokr√≥l
    }
    render();
}

// KI√çR√ÅS & SZ√ÅMOL√ÅS
function render() {
    // 1. T√°bl√°zat kirajzol√°sa (Ford√≠tott sorrend)
    const tbody = document.getElementById('histBody');
    tbody.innerHTML = '';
    
    // M√°solatot csin√°lunk a ford√≠t√°shoz, hogy az eredeti t√∂mb ne s√©r√ºlj√∂n
    [...history].reverse().forEach(row => {
        tbody.innerHTML += `
            <tr>
                <td>${row.name}<br><small style="color:#64748b">${row.date}</small></td>
                <td>${row.read}</td>
                <td style="color:${row.cons > 210 ? '#ef4444' : '#10b981'}">${Math.round(row.cost).toLocaleString()} Ft</td>
            </tr>
        `;
    });

    // 2. Az UTOLS√ì elem az "El≈ëz≈ë" √≥ra√°ll√°s
    const lastEntry = history[history.length - 1];
    document.getElementById('prevDisp').innerText = lastEntry.read;
    // Elt√°roljuk attrib√∫tumban a sz√°mol√°shoz
    document.getElementById('prevDisp').dataset.val = lastEntry.read;
}

function calc() {
    const prev = parseFloat(document.getElementById('prevDisp').dataset.val);
    const curr = parseFloat(document.getElementById('currInput').value);
    const pct = parseInt(document.getElementById('slider').value);

    // Kijelz≈ëk friss√≠t√©se
    document.getElementById('momPct').innerText = pct;

    if (!curr || curr <= prev) {
        // Ha nincs adat vagy kisebb
        document.getElementById('totalPrice').innerText = "0 Ft";
        document.getElementById('consVal').innerText = "0";
        document.getElementById('momMoney').innerText = "0 Ft";
        document.getElementById('myMoney').innerText = "0 Ft";
        return null;
    }

    // Fogyaszt√°s
    const cons = curr - prev;
    document.getElementById('consVal').innerText = cons;

    // K√∂lts√©g k√©plet
    let total = 0;
    if (cons <= LIMIT) {
        total = cons * P_REZSI;
    } else {
        total = (LIMIT * P_REZSI) + ((cons - LIMIT) * P_PIACI);
    }

    document.getElementById('totalPrice').innerText = Math.round(total).toLocaleString() + " Ft";

    // Megoszt√°s
    const mom = total * (pct / 100);
    const me = total - mom;

    document.getElementById('momMoney').innerText = Math.round(mom).toLocaleString() + " Ft";
    document.getElementById('myMoney').innerText = Math.round(me).toLocaleString() + " Ft";

    return { cons, total, curr };
}

function save() {
    const data = calc();
    if (!data) {
        alert("Hib√°s vagy hi√°nyz√≥ √≥ra√°ll√°s!");
        return;
    }

    if(confirm("Biztosan mented? Ezzel lez√°rod a h√≥napot.")) {
        const now = new Date();
        const monthNames = ["Janu√°r","Febru√°r","M√°rcius","√Åprilis","M√°jus","J√∫nius","J√∫lius","Augusztus","Szeptember","Okt√≥ber","November","December"];
        
        history.push({
            date: now.toISOString().split('T')[0],
            name: monthNames[now.getMonth()], // Aktu√°lis h√≥nap neve
            read: data.curr,
            cons: data.cons,
            cost: data.total
        });

        // Ment√©s a telefonra
        localStorage.setItem('mvm_data_simple', JSON.stringify(history));
        
        // Mez≈ë t√∂rl√©se √©s √∫jrarajzol√°s
        document.getElementById('currInput').value = "";
        render(); // Ez friss√≠ti az "El≈ëz≈ë" √≥ra√°ll√°st is az √∫jra!
        calc();   // Ez null√°zza a sz√°mol√≥t
        alert("Mentve!");
    }
}

function hardReset() {
    if(confirm("Ez T√ñR√ñL minden √∫j ment√©st √©s vissza√°ll az alap 2025-√∂s adatokra. Biztos?")) {
        localStorage.removeItem('mvm_data_simple');
        location.reload();
    }
}

// IND√çT√ÅS
init();

</script>
</body>
</html>
